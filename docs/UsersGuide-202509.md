# PointGPS 利用者の手引（2025年 9月版）

## はじめに

PointGPSは、国土地理院地図上でGPSポイントを簡単に管理できるWebアプリケーションです。最新版（v1.0）ではExcel専用化により大幅な高速化（30-50倍）を実現し、フィールド配置の改善、厳密なデータ検証機能を追加しました。このガイドでは、初心者から上級者まで、効率的にアプリを使用する方法を説明します。

## 目次

1. [セットアップ](#セットアップ)
2. [基本操作](#基本操作)
3. [データの読み込み](#データの読み込み)
4. [ポイント操作](#ポイント操作)
5. [データの出力](#データの出力)
6. [高度な機能](#高度な機能)
7. [トラブルシューティング](#トラブルシューティング)
8. [よくある質問](#よくある質問)

## セットアップ

### 動作環境
- **ブラウザ**: Chrome 90+、Firefox 88+、Safari 14+、Edge 90+（最新版推奨）
- **ネットワーク**: インターネット接続必須（地図データ・標高API取得のため）
- **ローカルサーバー**: ファイル読み込みにはローカルサーバーが必要

### 起動方法
1. **ローカルサーバーを起動**
   ```bash
   # Pythonを使用
   python -m http.server 8000
   
   # またはnpm serveを使用
   npx serve .
   ```

2. **ブラウザでアクセス**
   - `http://localhost:8000` を開く
   - PointGPSアプリが表示されます

### 初回起動時の確認事項
- 地図が正常に表示される
- 右側に操作パネルが表示される
- 初期地図位置が箕面大滝周辺（大阪府）に設定される

## 基本操作

### 画面構成
- **地図エリア**: メインの地図表示（画面全体）
- **操作パネル**: ポイント編集ツール（右上固定、320px幅）
- **メッセージエリア**: 操作結果の通知（画面中央ポップアップ）

### 地図操作
- **ズーム**: マウスホイール、またはズームボタン（右下の+/-）
- **パン**: 地図をドラッグして移動
- **スケール**: 右下にメートル単位のスケールバー表示

### 基本的な操作の流れ
1. **データ読み込み** → 統合読み込みボタンで形式を選択してファイルを読み込む
2. **ポイント表示確認** → 地図上にポイントが表示される
3. **ポイント選択・編集** → 必要に応じて情報を編集
4. **データ出力** → 統合出力ボタンで形式を選択してファイルを保存

## データの読み込み

### Excel専用読み込み（v2.2の大幅高速化）

**v2.2の重要変更**: GeoJSON機能を廃止し、Excel専用化による30-50倍の高速化を実現。

1. **「ポイント読み込み」ボタン** - Excel(.xlsx)ファイル専用
2. **高速読み込み**: 100ポイントが約300-500ms で処理完了

### Excelファイルの読み込み（v2.2厳密仕様）

1. **「ポイント読み込み」ボタンをクリック**
2. **Excelファイル(.xlsx)を選択**
3. **厳密なファイル形式要件**:
   - **拡張子**: .xlsxのみ対応
   - **必須列（完全一致判定）**:
     - **ポイントID**: "ポイントID"（完全一致必須）
     - **名称**: "名称"（完全一致必須）
     - **緯度**: "緯度"（完全一致必須）
     - **経度**: "経度"（完全一致必須）
   - **任意列**:
     - **標高**: "標高"（完全一致、空白可）
     - **備考**: "備考"（完全一致、空白可）
   - **座標データ**: 10進数形式または度分秒形式

4. **v2.2の高速処理**:
   - **即座に読み込み完了**: 標高API取得を削除し30-50倍高速化
   - **必須項目チェック**: 不足行の自動スキップ
   - **データ検証**: 座標値の自動変換・検証

5. **読み込み結果**:
   - 成功時: ポイントが地図上に緑色の円マーカーで表示
   - ポイント数がカウンター表示
   - 成功メッセージが3秒間表示

### GeoJSON機能の廃止

**v2.2重要変更**: GeoJSON機能は完全に削除されました。

**廃止理由**:
- パフォーマンス向上のための仕様統一
- Excel形式の圧倒的な利用頻度
- メンテナンス性とコード品質の向上

**代替方法**: 他のGISツールでGeoJSON → Excel変換後に使用してください。

### 座標変換機能

アプリケーションは以下の座標形式を自動認識・変換します：

- **度分秒形式 → 10進数変換**
  - `35°30'45"N` → `35.5125`
  - `35度30分45秒N` → `35.5125`
  - `E135°28'19.35"` → `135.472041`

### 読み込み時の注意事項（v2.2改善版）
- **大容量ファイル**: Excel 10MB程度まで推奨
- **列名の厳密一致**: "ポイントID"、"名称"、"緯度"、"経度"は完全一致必須
- **必須項目チェック**: 必須項目が欠けている行は自動スキップ
- **データ検証**: 座標値の自動変換・検証（DMS→10進数）
- **高速処理**: v2.2では読み込み時の標高API取得を削除し大幅高速化

### Excel専用化の利点（v2.2）

**v2.2のExcel専用化により以下が大幅改善されました**:
- **劇的な高速化**: 30-50倍の処理速度向上
- **シンプルな操作**: ファイル形式選択が不要
- **データ品質向上**: 厳密な列名一致による確実な読み込み
- **メンテナンス性**: 単一形式による高品質な機能提供

**💡 使用のヒント**: 
- Excel列名は"ポイントID"、"名称"、"緯度"、"経度"で完全一致必須
- 100ポイントが約500ms以内で読み込み完了
- 大量データも快適に処理可能
- 標高データは選択時・追加時・移動時に自動取得

**📸 スクリーンショット推奨箇所**:
- Excel専用読み込みボタン
- Excel専用出力ボタン
- 新フィールド配置（名称が緯度の上、備考フィールド追加）

## ポイント操作

### ポイント追加

1. **「追加」ボタンをクリック**
2. **カーソルがクロスヘア（十字）に変化**
3. **地図上の任意の場所をクリック**
4. **新しいポイントが追加され、自動選択される**
5. **自動的にポイントIDフィールドがフォーカス・全選択される**

**新規ポイントの特徴**:
- **自動ID**: 仮01, 仮02... の連番で自動割り当て
- **自動標高取得**: 国土地理院標高APIから自動取得
- **即座に編集可能**: ポイントIDが全選択状態で編集しやすい

**💡 Tips**: 
- ESCキーで追加モードを終了
- 追加完了後は自動的にモード解除
- 新規ポイント追加後はTabキーでスムーズに名称編集へ移行可能

**📸 スクリーンショット推奨箇所**:
- 追加モード時のクロスヘアカーソル表示
- 新規ポイント追加直後のID全選択状態
- 自動標高取得完了時のフィールド表示

### ポイント選択

1. **地図上のポイント（緑色の円）をクリック**
2. **選択されたポイントはライムグリーン（#32cd32）に変化**
3. **右側パネルにポイント情報が表示**
4. **GPS標高が未設定の場合、自動取得される**

### ポイント移動

1. **移動したいポイントを選択**
2. **「移動」ボタンをクリック**
   - ボタンがライムグリーン（#32cd32）に変化
   - カーソルが移動カーソルに変化
3. **選択されたポイントをドラッグして移動**
   - **リアルタイム更新**: ドラッグ中に緯度・経度・DMS座標が動的に更新
   - 移動中は座標情報が常に最新値に更新
4. **ドロップ時に移動完了**
   - GPS標高が自動再取得
   - 移動モードが自動解除
   - 移動完了メッセージが表示

**移動モードの自動解除条件**:
- ドラッグ完了時（自動）
- 他のポイントをクリック
- 「追加」「削除」ボタンをクリック
- ESCキーを押下

**💡 移動操作のコツ**:
- 移動ボタンがライムグリーンになったことを確認してからドラッグ開始
- リアルタイム座標更新を見ながら正確な位置調整が可能
- 移動中はGPS標高も自動更新されるため、地形情報も把握できる

**📸 スクリーンショット推奨箇所**:
- 移動ボタンのライムグリーン化状態
- ドラッグ中のリアルタイム座標更新表示
- 移動カーソル表示状態

### ポイント削除

1. **削除したいポイントを選択**
2. **「削除」ボタンをクリック**
3. **確認ダイアログで「OK」をクリック**
4. **ポイントが地図とデータから完全削除**

### ポイント情報編集（v2.2新配置）

選択されたポイントの情報は右側パネルで確認・編集できます（v2.2で配置変更）：

| 順序 | フィールド | 編集可否 | タブ順序 | 説明 |
|------|------------|----------|----------|------|
| 1 | **ポイントID** | ✅ 編集可能 | 1 | 自動フォーマット機能付き |
| 2 | **名称** | ✅ 編集可能 | 2 | 場所名や説明（緯度の上に移動） |
| 3 | **緯度** | ❌ 読み取り専用 | - | 10進数5桁表示、リアルタイム更新 |
| 4 | **経度** | ❌ 読み取り専用 | - | 10進数5桁表示、リアルタイム更新 |
| 5 | **DMS** | ❌ 読み取り専用 | - | 度分秒形式、E/N方向表示付き |
| 6 | **標高** | ❌ 読み取り専用 | - | 国土地理院API取得値、小数点1位まで |
| 7 | **備考** | ✅ 編集可能 | 3 | v2.2で新規追加、任意テキスト入力 |

### タブ操作（キーボード操作）

効率的な編集のため、以下のタブ順序が設定されています（v2.2配置変更対応）：

1. **ポイントID** (tabindex="1") → Tab押下 → **名称** (tabindex="2") → Tab押下 → **備考** (tabindex="3")
2. 読み取り専用フィールド（緯度、経度、DMS、標高）はタブでスキップ (tabindex="-1")

**💡 キーボード効率化のヒント**:
- 新規ポイント追加後、自動でポイントIDにフォーカス＆全選択される
- 必要に応じてそのまま入力してIDを変更、またはTabで名称へ
- 読み取り専用フィールドはタブが当たらないため高速編集が可能

### ポイントID自動フォーマット

ポイントIDは以下のルールで自動正規化されます：

- **全角→半角変換**: ３ → 3
- **小文字→大文字変換**: p → P
- **0パディング**: 1 → 01
- **ハイフン自動挿入**: P01 → P-01
- **日本語文字**: そのまま保持

## データの出力

### Excel専用出力（v2.2）

**v2.2の変更**: Excel専用出力により、シンプルで高品質な出力機能を提供。

1. **「ポイント出力」ボタン** - Excel(.xlsx)ファイル専用出力

### Excel形式で出力（v2.2改善版）

1. **「ポイント出力」ボタンをクリック**
2. **保存ダイアログでファイル名・場所を指定**
3. **全ポイント情報が.xlsx形式で保存**

**出力内容（v2.2改善）**:
- **ヘッダー行**: ポイントID, 名称, 緯度, 経度, 標高, 備考
- **シート名**: "ポイントGPS"（v2.2で変更）
- **座標精度**: 緯度・経度は小数点以下5桁、標高は小数点1位まで
- **列幅**: 自動調整（日本語対応）
- **デフォルトファイル名**: `ポイントGPS-yyyymmdd.xlsx`

### GeoJSON出力の廃止

**v2.2重要変更**: GeoJSON出力機能は完全に削除されました。

**代替方法**: 出力されたExcelファイルを他のGISツールでGeoJSONに変換してご利用ください。

### ファイル保存方式

- **File System Access API対応ブラウザ（Chrome系）**: 直接保存ダイアログ
- **未対応ブラウザ**: 自動ダウンロード方式

## 高度な機能

### 標高の自動取得（v2.2最適化済み）

**データソース**: 国土地理院標高API（5mメッシュ、レーザー測量データ）

**v2.2の最適化されたAPI取得タイミング（限定的）**:
- **ポイント新規追加時**
- **ポイント選択時**（標高がblankまたは0の場合のみ）
- **ポイント移動完了時**

**v2.2で取得しないケース**:
- **Excel読み込み時**（高速化のため削除）
- **標高に正の値がある場合**

**処理仕様**:
- **数値処理**: 小数点1位まで（123.0は123として表示）
- **エラー処理**: API障害時は警告ログ出力、処理継続
- **表示**: 標高フィールドに自動表示

### リアルタイム座標更新

移動モード中は以下の情報がリアルタイム更新されます：

- **緯度・経度**: 10進数5桁表示
- **DMS座標**: 度分秒形式（東経・北緯順）
- **ポイントマーカー位置**: ドラッグ中の即座の反映

### 色とビジュアルフィードバック

**マーカー色**:
- **通常ポイント**: 緑色（#008000）
- **選択ポイント**: ライムグリーン（#32cd32）

**ボタン色**:
- **通常ボタン**: 青色（#3498db）
- **移動モード活性**: ライムグリーン（#32cd32）
- **エクスポートボタン**: オレンジ色（#e67e22）

**カーソル変更**:
- **追加モード**: 十字カーソル
- **移動モード**: 移動カーソル

### レスポンシブ対応

**デスクトップ（1024px以上）**:
- 右側固定操作パネル（320px幅）
- 全機能利用可能

**タブレット（768px〜1023px）**:
- 操作パネル全幅表示
- タッチ操作対応

**モバイル（767px以下）**:
- レイアウト最適化
- ボタン縦配置
- タッチ操作最適化

## トラブルシューティング

### よくあるエラーと対処法

#### 「ファイルが読み込めません」
**原因**: 
- ファイル形式不正（.xlsx以外）
- 必要列の不足または列名不一致
- ファイル破損

**対処法**: 
- ファイル形式を確認（.xlsx形式か？）
- 列名の完全一致を確認：
  - "ポイントID"（完全一致必須）
  - "名称"（完全一致必須）
  - "緯度"（完全一致必須）
  - "経度"（完全一致必須）
- 別のファイルで試行

#### 「地図が表示されません」
**原因**: 
- インターネット接続問題
- CDN読み込み失敗

**対処法**: 
- インターネット接続を確認
- ページを再読み込み（F5キー）
- ブラウザキャッシュをクリア

#### 「ポイントをドラッグできません」
**原因**: 
- 移動モードが有効でない
- 別のポイントが選択されている

**対処法**: 
- 移動したいポイントを選択
- 「移動」ボタンをクリック
- ボタンがライムグリーンに変化することを確認

#### 「GPS標高が取得できません」
**原因**: 
- 国土地理院API接続エラー
- 対象地域外（日本国外）
- 一時的なサーバー障害

**対処法**: 
- しばらく待ってから再試行
- 日本国内の座標か確認
- コンソールログでエラー詳細を確認

#### 「ローカルサーバーエラー」
**原因**: 
- CORS制限（file://プロトコル使用）
- サーバー未起動

**対処法**: 
- 必ずHTTPサーバー経由でアクセス
- `python -m http.server 8000` を実行
- `http://localhost:8000` でアクセス

### パフォーマンスの最適化

#### 大量ポイントでの動作が重い場合
1. **ブラウザメモリクリア**: 不要なタブを閉じる
2. **ポイント数調整**: 1000点程度に分割
3. **ズームレベル調整**: 必要以上に詳細表示しない

#### 地図表示が遅い場合
1. **ネットワーク速度確認**: 高速回線推奨
2. **ブラウザ最適化**: 最新版使用、拡張機能無効化
3. **キャッシュクリア**: 定期的なブラウザキャッシュクリア

## よくある質問

### Q: 対応しているファイル形式は？
**A**: v2.2ではExcel(.xlsx)形式のみ対応しています。GeoJSON機能は削除されました。.xlsファイルや.csvファイルは直接対応していません。

### Q: 最大何個のポイントを扱えますか？
**A**: 技術的な上限はありませんが、ブラウザのメモリに依存します。実用的には1000点程度まで快適に動作します。それ以上の場合は分割することを推奨します。

### Q: オフラインで使用できますか？
**A**: 地図表示と標高取得にはインターネット接続が必要です。ポイント編集などの基本機能は接続なしでも部分的に動作しますが、推奨しません。

### Q: スマートフォンで使用できますか？
**A**: はい。レスポンシブデザインによりタッチ操作に対応しており、スマートフォンやタブレットでも使用可能です。ただし、画面サイズの制約により一部機能は制限される場合があります。

### Q: データのバックアップは？
**A**: アプリケーションはデータを永続化しないため、定期的にExcelまたはGeoJSON形式でエクスポートすることを強く推奨します。

### Q: 座標系は何を使用していますか？
**A**: WGS84（世界測地系）の緯度経度座標系を使用しています。日本測地系（Tokyo Datum）には対応していません。

### Q: 商用利用は可能ですか？
**A**: アプリケーション自体のライセンス条項および国土地理院地図タイルの利用規約に準拠する必要があります。詳細はライセンス文書を確認してください。

### Q: ポイントIDに日本語は使えますか？
**A**: はい。ポイントIDには日本語文字も使用可能です。自動フォーマット機能は英数字のみに適用され、日本語文字はそのまま保持されます。

### Q: 移動中に座標が表示されるのは便利ですが、更新頻度は？
**A**: ドラッグ中はmousemoveイベントに同期してリアルタイム更新されます。非常に高頻度（通常60fps程度）で更新されるため、滑らかな座標変化が確認できます。

### Q: 標高データの取得について教えてください
**A**: 
v2.2では標高フィールドは読み取り専用で、国土地理院の5mメッシュレーザー測量データから自動取得されます。手動編集は不可ですが、高精度なデータを提供します。API取得は必要時のみ行われ、処理速度が大幅に改善されています。

## サポート情報

### 技術サポート
- **詳細仕様**: `docs/funcspec.md` 参照
- **ソースコード**: JavaScript ES6 modules構成
- **開発環境**: ローカルHTTPサーバーでの動作必須
- **CLAUDE.md**: 開発者向け詳細情報

### システム要件
- **CPU**: 1GHz以上推奨
- **メモリ**: 2GB以上推奨
- **ストレージ**: 特に制限なし（ブラウザ一時領域のみ使用）
- **ネットワーク**: 常時接続推奨

### アップデート情報
- **更新頻度**: 機能追加、バグ修正に応じて随時
- **後方互換性**: データファイル形式の互換性維持
- **変更履歴**: 各ドキュメント内の更新履歴を参照

### セキュリティ
- **データ処理**: 完全ローカル処理（サーバー送信なし）
- **外部通信**: 地図タイル、標高API（HTTPS）のみ
- **プライバシー**: 位置情報は明示的入力のみ、自動収集なし

---

---

## v2.2の主な新機能・改善点（大幅アップデート）

### Excel専用化による大幅高速化
- **GeoJSON機能完全削除**: Excel形式に特化し処理効率を最大化
- **30-50倍高速化**: Excel読み込み時の標高API取得削除により劇的な速度向上
- **処理時間**: 100ポイント約300-500ms（従来は10-15秒）

### フィールド配置変更・機能追加
- **名称フィールドの位置変更**: 緯度の上に移動し、より論理的な配置を実現
- **備考フィールド新規追加**: 任意テキスト入力が可能な備考フィールドを追加
- **タブ順序最適化**: ポイントID → 名称 → 備考の効率的な順序

### 厳密なデータ検証
- **完全一致列名判定**: "ポイントID"、"名称"、"緯度"、"経度"の厳密な一致が必要
- **必須項目チェック強化**: 必須項目が欠けている行の自動スキップ
- **データ品質向上**: より確実で予測可能な読み込み処理

### Excel出力機能改善
- **座標精度調整**: 緯度・経度は小数点以下5桁、標高は小数点1位まで
- **列幅自動調整**: 日本語文字対応の自動幅調整機能
- **シート名変更**: "ポイントGPS"に統一

### コード品質向上
- **未使用関数削除**: 重複処理の統合とコードの最適化
- **処理統一**: ExcelWorkbook作成の一元化
- **メンテナンス性向上**: コード構造の整理と改善

---

**最終更新**: 2025年 9月 9日  
**バージョン**: v1.0  
**対応ブラウザ**: Chrome 90+, Firefox 88+, Safari 14+, Edge 90+

**© 2025 PointGPS Development Team. All rights reserved.**