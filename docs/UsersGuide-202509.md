# PointGPS 利用者の手引（2025年9月版）

**バージョン**: v1.0
**作成日**: 2025年9月12日
**対象**: 一般利用者向け操作ガイド

## はじめに

PointGPSは、国土地理院地図上でGPSポイントを簡単に管理できるWebアプリケーションです。データの格納先はExcelのみとしています。

## 目次

1. [はじめにお読みください](#はじめにお読みください)
2. [基本操作](#基本操作)
3. [ポイント管理](#ポイント管理)
4. [便利機能](#便利機能)
5. [設定とカスタマイズ](#設定とカスタマイズ)
6. [トラブルシューティング](#トラブルシューティング)
7. [よくある質問](#よくある質問)

## はじめにお読みください

### 動作環境
- **推奨ブラウザ**: Chrome 90+、Firefox 88+、Safari 14+、Edge 90+
- **インターネット接続**: 必須（地図タイル・標高データの取得のため）
- **ローカルサーバー**: 必須（CORS制限回避のため）

### 重要なお知らせ
- **動的メッセージ表示**: ポイント操作時に具体的なポイントID付きメッセージが表示されます
- **1000行制限**: Excelファイル読み込み時、最大1000行まで処理されます

## 基本操作

### アプリケーションの起動

1. **ローカルサーバーの起動**
   ```bash
   # Python使用の場合
   python -m http.server 8000

   # または npm serve使用の場合
   npx serve .
   ```

2. **ブラウザでアクセス**
   - URL: `http://localhost:8000`
   - 地図が表示され、右側に操作パネルが配置されます

### 画面構成

- **地図エリア**: 国土地理院地図（初期表示：箕面大滝周辺）
- **操作パネル**: 右側固定（デスクトップ）または上部（モバイル）
- **メッセージエリア**: 画面中央（操作時に表示）

## ポイント管理

### Excelファイルからの読み込み

#### 対応ファイル形式
- **Excel (.xlsx)**: 対応
- **その他形式**: 非対応

#### 必要な列構成
| 列名（完全一致必須） | 必須 | 内容例 |
|---------------------|------|--------|
| ポイントID | ✓ | A-01, P-05, 仮01 |
| 名称 | ✓ | 箕面大滝, 駅前広場 |
| 緯度 | ✓ | 34.853667 または 34°51'13.2" |
| 経度 | ✓ | 135.472041 または 135°28'19.3" |
| 標高 | | 150, 123.5 |
| 備考 | | 観光名所, 待ち合わせ場所 |

#### 読み込み手順

1. **「ポイント読み込み」ボタンをクリック**
2. **Excelファイル(.xlsx)を選択**
3. **処理完了を待機**
   - 200ポイント程度なら約0.5～1秒で完了
   - 1000行制限に達した場合は警告メッセージが表示

#### 1000行制限

大容量ファイル（1000行超）の読み込み時：
- **警告メッセージ**: 「読み込み行数が上限に達しました。最初の1000行のみ処理されました。」
- **対処法**: ファイルを分割するか、重要なポイントを最初の1000行に配置

💡 **Tips**: ヘッダー行は制限にカウントされません

#### 操作手順

1. **「ポイント追加」ボタンをクリック**
2. **地図上の任意の場所をクリック**
3. **自動処理**
   - ポイント生成（「仮01」「仮02」...の連番ID）
   - 標高の自動取得（国土地理院API）
   - ポイント情報表示エリアの更新

#### 動的メッセージ表示

- **表示例**: 「ポイント 仮01 を追加しました」
- **表示時間**: 3秒間
- **特徴**: 具体的なポイントIDを含んだ分かりやすいメッセージ

### ポイントの移動

#### 操作手順

1. **移動したいポイントをクリック**（選択状態：ライムグリーン色）
2. **「ポイント移動」ボタンをクリック**
3. **動的メッセージを表示**: 「ポイント A-02 をドラッグして移動してください」
4. **ポイントをドラッグ**して新しい位置に移動
5. **自動処理**
   - 座標情報のリアルタイム更新
   - 標高の再取得
   - 移動完了メッセージ：「ポイント A-02 を移動しました」

#### 移動モードの終了方法
- **自動終了**: ドラッグ完了時
- **手動終了**: ESCキー押下
- **他の操作**: 他ボタンクリック時

### ポイントの削除

#### 操作手順

1. **削除したいポイントをクリック**（選択状態）
2. **「ポイント削除」ボタンをクリック**
3. **確認ダイアログ**で「OK」を選択
4. **動的メッセージを表示**: 「ポイント A-02 を削除しました」

### ファイル出力（Excel専用）

#### 出力手順

1. **「ポイント出力」ボタンをクリック**
2. **保存場所とファイル名を指定**
   - デフォルト名: 「ポイントGPS-20250912.xlsx」
   - 対応ブラウザ: ダイアログ表示
   - 非対応ブラウザ: 自動ダウンロード
3. **保存完了**

#### 出力形式
- **ファイル形式**: Excel (.xlsx)
- **シート名**: 「ポイントGPS」
- **座標精度**: 緯度・経度は小数点以下5桁、標高は小数点以下1桁
- **列幅**: 日本語対応の自動調整

## 便利機能

### ポイントID自動フォーマット（v2.3継続機能）

ポイントIDフィールドの入力時に自動修正されます：

#### 変換例
- `p1` → `P-01` （大文字化・0パディング・ハイフン挿入）
- `Ａ１` → `A-01` （全角→半角変換）
- `箕面１` → `箕面1` （数字のみ半角、漢字は保持）

#### 変換タイミング
- フィールドからフォーカスが外れた時（blur時）
- 修正された場合は確認メッセージ表示

### 座標表示機能

#### 複数形式での座標表示
- **10進数**: 34.853667, 135.472041
- **DMS（度分秒）**: 北緯34°51'13.2", 東経135°28'19.3"

#### リアルタイム更新
- ポイント移動中に座標情報が動的に更新
- 緯度・経度・DMS形式すべて同時更新

### 標高自動取得

#### 国土地理院API連携
- **データソース**: 5mメッシュ、レーザー測量データ
- **取得タイミング**:
  - 新規ポイント追加時
  - 既存ポイント選択時（標高が空白または0の場合のみ）
  - ポイント移動完了時

#### 表示形式
- 小数点1位まで表示
- 整数の場合は「123」として表示（123.0ではない）

### キーボード操作

#### タブ順序
1. ポイントID（編集可能）
2. 名称（編集可能）
3. 備考（編集可能）

#### ショートカットキー
- **ESC**: 全モード終了（追加・移動・編集）
- **Tab**: 次フィールドへ移動
- **Shift+Tab**: 前フィールドへ移動

## 設定とカスタマイズ

### レスポンシブデザイン

#### 画面サイズ別レイアウト
- **デスクトップ（1024px以上）**: 右側固定パネル
- **タブレット（768-1023px）**: 全幅パネル
- **モバイル（767px以下）**: 縦積みレイアウト

#### タッチ操作（モバイル・タブレット）
- **ピンチズーム**: 地図の拡大・縮小
- **タップ**: ポイント選択
- **ドラッグ**: ポイント移動

### ブラウザ設定

#### 推奨設定
- **JavaScript**: 有効
- **Cookie**: 設定保存のため有効推奨
- **位置情報**: 使用しません（手動入力のみ）

## トラブルシューティング

### よくあるエラーと対処法

#### 1. ファイル読み込みエラー

**エラー**: 「Excelファイルの読み込みに失敗しました」

**原因と対処法**:
- ✓ ファイル形式を確認（.xlsxのみ対応）
- ✓ 列名を確認（「ポイントID」「名称」「緯度」「経度」が必須）
- ✓ ファイルが破損していないか確認

#### 2. 1000行制限エラー

**メッセージ**: 「読み込み行数が上限に達しました」

**対処法**:
- ファイルを複数に分割
- 重要なポイントを最初の1000行に配置
- 不要な行を削除

#### 3. 標高取得エラー

**症状**: 標高が表示されない

**原因と対処法**:
- ✓ インターネット接続を確認
- ✓ 国土地理院APIの利用可能性確認
- ✓ 座標が日本国内かを確認

#### 4. ポイント移動できない

**原因と対処法**:
- ✓ ポイントを選択してから「ポイント移動」ボタンをクリック
- ✓ ライムグリーン色になっているか確認
- ✓ ESCキーで一度モードをリセット

#### 5. ファイル保存できない

**原因と対処法**:
- ✓ ブラウザの「ダウンロード」設定を確認
- ✓ 保存先フォルダの書き込み権限を確認
- ✓ 十分な空き容量があるか確認

### パフォーマンス最適化

#### 大量ポイント処理時の推奨事項

**500ポイント以上の場合**:
- ✓ 他のタブを閉じる
- ✓ 不要なブラウザ拡張機能を無効化
- ✓ 定期的にデータを保存

**1000ポイント近く処理する場合**:
- ✓ 分割処理を推奨
- ✓ 処理完了まで他の操作を控える

## よくある質問

### Q1: 1000行制限を解除できますか？

**A1**: 現在、設定変更による制限解除は利用者画面では不可能です。大容量データの場合、以下を推奨：
- ファイルの分割処理
- 重要なポイントの優先配置
- 段階的なデータ投入

### Q2: GeoJSONファイルは使えますか？

**A2**: GeoJSONファイルはサポートしておりません。Excel (.xlsx) 専用となっています。

### Q3: データはどこに保存されますか？

**A3**:
- **ブラウザ内**: 一時的にメモリ上に保持
- **永続化**: Excelファイル出力で保存
- **クラウド連携**: なし（完全ローカル処理）

### Q4: 座標系は何に対応していますか？

**A4**:
- **対応**: WGS84のみ
- **非対応**: 日本測地系、UTM座標系
- **変換**: DMS（度分秒） ⇔ 10進数は自動対応

### Q5: オフラインでも使えますか？

**A5**: 部分的に対応：
- **必要**: インターネット接続（地図・標高取得）
- **可能**: ポイント編集・移動（地図表示後）
- **不可**: 初回地図読み込み、標高取得

### Q6: エラーメッセージの表示時間は変更できますか？

**A6**: v2.3では以下の表示時間が設定されています（変更不可）：
- **通常メッセージ**: 3秒
- **警告**: 4.5秒
- **エラー**: 6秒

### Q7: ポイントIDの形式に決まりはありますか？

**A7**: 自動フォーマット機能により以下に統一：
- **推奨形式**: X-nn（英大文字1桁-数字2桁）
- **例**: A-01, P-05, Z-99
- **自動変換**: 入力時に自動修正
- **日本語**: 漢字・ひらがな・カタカナも使用可能

---

## 更新履歴

| バージョン | 日付 | 主な変更内容 |
|-----------|------|-------------|
| v1.0 | 2025-09-12 | 初版作成 |

## お問い合わせ・サポート

技術的な問題や使用方法についてご質問がございましたら、開発者向けドキュメント（CLAUDE.md）も併せてご確認ください。

---

**ドキュメント作成**: Claude Code
**最終更新**: 2025年9月12日
**対象バージョン**: PointGPS v1.0